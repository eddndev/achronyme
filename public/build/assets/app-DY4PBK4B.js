import{i as E,a as C,v as f}from"./validation-BT8GwmWI.js";import{e as g,p as F}from"./mathjs-CqmDO44L.js";import{C as p,r as M}from"./chart-Co7ClN-s.js";function v(t,e,a){try{if(!t||t.length===0)throw new Error("No se proporcionaron funciones para el cálculo.");if(e<=0)throw new Error("El rango de frecuencia debe ser positivo.");if(a<10)throw new Error("La resolución debe ser al menos 10 puntos.");const n=[],i=[],l=[],r=[],o=[],d=2*e/a;for(let s=-e;s<=e;s+=d){n.push(s);let c=0,u=0;for(const h of t)try{c+=E(m=>h.compiled.evaluate({t:m})*Math.cos(s*m),h.domainStart,h.domainEnd,1e3),u-=E(m=>h.compiled.evaluate({t:m})*Math.sin(s*m),h.domainStart,h.domainEnd,1e3)}catch(b){console.warn(`Error evaluating function at ω=${s}:`,b.message)}r.push(c),o.push(u);const w=Math.sqrt(c*c+u*u);i.push(w);const x=Math.atan2(u,c);l.push(x)}return console.log(`[Fourier Transform] Calculated ${n.length} frequency points`),console.log(`[Fourier Transform] ω range: [${n[0].toFixed(2)}, ${n[n.length-1].toFixed(2)}] rad/s`),{success:!0,omega:n,magnitude:i,phase:l,real:r,imag:o}}catch(n){return console.error("[Fourier Transform] Calculation error:",n),{success:!1,omega:[],magnitude:[],phase:[],real:[],imag:[],error:n.message}}}function S(t,e=500){if(!t||t.length===0)return{t:[],values:[]};const a=[],n=[],i=t[0].domainStart,l=t[t.length-1].domainEnd,r=(l-i)/e;for(let o=i;o<=l;o+=r){a.push(o);let d=0;for(const s of t)if(o>=s.domainStart-1e-9&&o<=s.domainEnd+1e-9){try{d=s.compiled.evaluate({t:o}),isFinite(d)||(d=0)}catch{d=0}break}n.push(d)}return{t:a,values:n}}function k(){return{isLoading:!1,errorMessage:"",resizeObserver:null,renderOptions:["time","magnitude","phase"],omegaRange:20,samplingResolution:500,nextId:2,functions:[{id:1,definition:"exp(-abs(t))",domainStart:"-5",domainEnd:"5",definitionError:null,domainStartError:null,domainEndError:null}],init(){console.log("[Alpine] Initializing fourierTransformState..."),window.TimeDomainChart.init(),window.MagnitudeChart.init(),window.PhaseChart.init(),[document.getElementById("timeDomainContainer"),document.getElementById("magnitudeContainer"),document.getElementById("phaseContainer")].forEach(e=>{e&&(new ResizeObserver(()=>{window.TimeDomainChart.chart&&window.TimeDomainChart.chart.resize(),window.MagnitudeChart.chart&&window.MagnitudeChart.chart.resize(),window.PhaseChart.chart&&window.PhaseChart.chart.resize()}).observe(e),console.log("[Alpine] ResizeObserver attached to container"))}),this.$watch("renderOptions",()=>{console.log("[Alpine] Render options changed:",this.renderOptions)}),this.$watch("omegaRange",()=>{console.log("[Alpine] Omega range changed:",this.omegaRange)})},addFunction(){const t=this.functions[this.functions.length-1];this.functions.push({id:this.nextId++,definition:"0",domainStart:t.domainEnd,domainEnd:"",definitionError:null,domainStartError:null,domainEndError:null})},removeFunction(t){if(this.functions.length>1){const e=this.functions.findIndex(a=>a.id===t);if(e>-1){if(e>0&&e<this.functions.length-1){const a=this.functions[e-1],n=this.functions[e+1];n&&(n.domainStart=a.domainEnd)}this.functions=this.functions.filter(a=>a.id!==t)}}},validate(){this.errorMessage="";let t=!1;if(this.functions.forEach(e=>{e.definitionError=null,e.domainStartError=null,e.domainEndError=null}),this.functions.length===0)return this.errorMessage="Debe haber al menos una función definida.",!1;for(let e=0;e<this.functions.length;e++){const a=this.functions[e],n=C(a.definition,"t");n.isValid||(a.definitionError=n.error,t=!0);const i=f(a.domainStart);i.isValid||(a.domainStartError=i.error,t=!0);const l=f(a.domainEnd);if(l.isValid||(a.domainEndError=l.error,t=!0),e>0){const r=this.functions[e-1];try{if(f(r.domainEnd).isValid&&f(a.domainStart).isValid){const o=g(r.domainEnd),d=g(a.domainStart);if(o!==d){t=!0;const s=`Debe coincidir con el dominio anterior (${o})`;a.domainStartError=a.domainStartError?`${a.domainStartError}. ${s}`:s}}}catch{}}}return!t},async calculateTransform(){if(this.isLoading=!0,this.errorMessage="",!this.validate()){this.isLoading=!1;return}try{console.log("[Alpine] Calculating Fourier Transform...");const t=this.functions.map(n=>({compiled:F(n.definition).compile(),domainStart:g(n.domainStart),domainEnd:g(n.domainEnd)})),e=S(t,500),a=v(t,this.omegaRange,this.samplingResolution);if(!a.success)throw new Error(a.error||"Error en el cálculo de la transformada");this.renderOptions.includes("time")&&window.TimeDomainChart.redraw({t:e.t,values:e.values}),this.renderOptions.includes("magnitude")&&window.MagnitudeChart.redraw({omega:a.omega,magnitude:a.magnitude}),this.renderOptions.includes("phase")&&window.PhaseChart.redraw({omega:a.omega,phase:a.phase}),console.log("[Alpine] Fourier Transform calculation completed successfully")}catch(t){console.error("[Alpine] Calculation Error:",t),this.errorMessage=t.message}finally{this.isLoading=!1}}}}window.fourierTransformState=k;p.register(...M);window.TimeDomainChart={chart:null,init(){const t=document.getElementById("timeDomainChart"),e=document.getElementById("timeDomainContainer");if(!t||!e){console.error("Time domain chart canvas or container not found!");return}this.chart&&this.chart.destroy(),t.style.width="100%",t.style.height="100%",t.style.maxWidth="100%";const a={type:"line",data:{labels:[],datasets:[]},options:{responsive:!0,maintainAspectRatio:!1,animation:!1,scales:{x:{title:{display:!0,text:"t (tiempo)"},ticks:{maxTicksLimit:15,callback:function(n,i,l){const r=parseFloat(this.getLabelForValue(n));return Math.abs(r)<1e-10?"0":Math.abs(r)<.01||Math.abs(r)>1e3?r.toExponential(2):r.toFixed(2)}}},y:{title:{display:!0,text:"f(t)"},ticks:{callback:function(n){const i=n;return Math.abs(i)<1e-10?"0":Math.abs(i)<.01||Math.abs(i)>1e3?i.toExponential(2):i.toFixed(2)}}}},plugins:{legend:{position:"top"},tooltip:{mode:"index",intersect:!1}},elements:{point:{radius:0}}}};this.chart=new p(t,a)},redraw(t){this.chart&&(this.chart.data.labels=t.t.map(e=>e.toFixed(2)),this.chart.data.datasets=[{label:"f(t)",data:t.values,borderColor:"rgb(59, 130, 246)",borderWidth:2,tension:.1}],this.chart.update("none"))},clear(){this.chart&&(this.chart.data.labels=[],this.chart.data.datasets=[],this.chart.update("none"))}};window.MagnitudeChart={chart:null,init(){const t=document.getElementById("magnitudeChart"),e=document.getElementById("magnitudeContainer");if(!t||!e){console.error("Magnitude chart canvas or container not found!");return}this.chart&&this.chart.destroy(),t.style.width="100%",t.style.height="100%",t.style.maxWidth="100%";const a={type:"line",data:{labels:[],datasets:[]},options:{responsive:!0,maintainAspectRatio:!1,animation:!1,scales:{x:{title:{display:!0,text:"ω (rad/s)"},ticks:{maxTicksLimit:10,callback:function(n,i,l){const r=parseFloat(this.getLabelForValue(n));return Math.abs(r)<1e-10?"0":Math.abs(r)<.01||Math.abs(r)>1e3?r.toExponential(1):r.toFixed(1)}}},y:{title:{display:!0,text:"|F(ω)|"},ticks:{callback:function(n){const i=n;return Math.abs(i)<1e-10?"0":Math.abs(i)<.01||Math.abs(i)>1e3?i.toExponential(1):i.toFixed(2)}}}},plugins:{legend:{position:"top"},tooltip:{mode:"index",intersect:!1}},elements:{point:{radius:0}}}};this.chart=new p(t,a)},redraw(t){this.chart&&(this.chart.data.labels=t.omega.map(e=>e.toFixed(2)),this.chart.data.datasets=[{label:"|F(ω)|",data:t.magnitude,borderColor:"rgb(34, 197, 94)",backgroundColor:"rgba(34, 197, 94, 0.1)",borderWidth:2,fill:!0,tension:.1}],this.chart.update("none"))},clear(){this.chart&&(this.chart.data.labels=[],this.chart.data.datasets=[],this.chart.update("none"))}};window.PhaseChart={chart:null,init(){const t=document.getElementById("phaseChart"),e=document.getElementById("phaseContainer");if(!t||!e){console.error("Phase chart canvas or container not found!");return}this.chart&&this.chart.destroy(),t.style.width="100%",t.style.height="100%",t.style.maxWidth="100%";const a={type:"line",data:{labels:[],datasets:[]},options:{responsive:!0,maintainAspectRatio:!1,animation:!1,scales:{x:{title:{display:!0,text:"ω (rad/s)"},ticks:{maxTicksLimit:10,callback:function(n,i,l){const r=parseFloat(this.getLabelForValue(n));return Math.abs(r)<1e-10?"0":Math.abs(r)<.01||Math.abs(r)>1e3?r.toExponential(1):r.toFixed(1)}}},y:{title:{display:!0,text:"∠F(ω) (rad)"},ticks:{callback:function(n){const i=n;return Math.abs(i)<1e-10?"0":Math.abs(i)<.01||Math.abs(i)>1e3?i.toExponential(1):i.toFixed(2)}}}},plugins:{legend:{position:"top"},tooltip:{mode:"index",intersect:!1}},elements:{point:{radius:0}}}};this.chart=new p(t,a)},redraw(t){this.chart&&(this.chart.data.labels=t.omega.map(e=>e.toFixed(2)),this.chart.data.datasets=[{label:"∠F(ω)",data:t.phase,borderColor:"rgb(168, 85, 247)",backgroundColor:"rgba(168, 85, 247, 0.1)",borderWidth:2,fill:!0,tension:.1}],this.chart.update("none"))},clear(){this.chart&&(this.chart.data.labels=[],this.chart.data.datasets=[],this.chart.update("none"))}};
